go_obfuscate_win:
  stage: obfuscate
  variables:
    GIT_SSL_NO_VERIFY: "true"
    GCP_PROJECT_ID: $GCP_PROJECT_ID
    GO_BIN_FOLDER: 'C:/go/bin'
  image: gcr.io/$GCP_PROJECT_ID/golang:windowsservercore-1809-pwsh
  tags: 
   - kubernetes
   - windows
  script:
    - 'go version'
    - 'go get -u github.com/unixpickle/gobfuscate'
    - 'go get -u $env:GO_GET_PATH'
    - 'gobfuscate -verbose $env:GO_GET_PATH $env:EXE_FILE_NAME-obfuscated.exe'
    - 'dir C:/go/bin'
    - 'dir'
# Upload artifact
    - 'curl.exe -L https://storage.googleapis.com/$CI_CD_UTILS_BUKCET/bins/gitlab-runner-helper.exe --output "gitlab-runner-helper.exe"'
    - '.\gitlab-runner-helper.exe --version'
    - '.\gitlab-runner-helper.exe artifacts-uploader --id $env:CI_JOB_ID --token $env:CI_JOB_TOKEN --url $env:CI_SERVER_URL --path ./$env:EXE_FILE_NAME --expire-in "1 week" --verbose'

